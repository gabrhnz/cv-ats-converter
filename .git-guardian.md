# 🛡️ Git Guardian - Protección de Secretos

## ✅ Instalado y Configurado

**Herramienta**: git-secrets  
**Estado**: ✅ Activo  
**Fecha**: 14 de Octubre, 2025

---

## 🔒 Protecciones Activas

### Hooks Instalados
- ✅ `pre-commit` - Escanea antes de cada commit
- ✅ `commit-msg` - Valida mensajes de commit
- ✅ `prepare-commit-msg` - Prepara mensajes seguros

### Patrones Detectados

1. **OpenRouter API Keys**
   - `sk-or-v1-[a-zA-Z0-9]{64}`
   - `OPENROUTER_API_KEY=sk-...`

2. **AWS Keys**
   - `AKIA[0-9A-Z]{16}`

3. **GitHub Tokens**
   - `ghp_...` (Personal Access Tokens)
   - `gho_...` (OAuth Tokens)

4. **Vercel Tokens**
   - `vercel.*token`

5. **Private Keys**
   - `-----BEGIN PRIVATE KEY-----`

6. **Generic Secrets**
   - `API_KEY="..."`
   - `SECRET="..."`
   - `PASSWORD="..."`

---

## 🧪 Probar la Protección

```bash
# Esto debería FALLAR (bloqueado por git-secrets)
echo "OPENROUTER_API_KEY=sk-or-v1-test123" > test.txt
git add test.txt
git commit -m "test"

# Verás un error como:
# test.txt:1:OPENROUTER_API_KEY=sk-or-v1-test123
# [ERROR] Matched one or more prohibited patterns
```

---

## 🔧 Comandos Útiles

### Escanear Repositorio Completo
```bash
git secrets --scan
```

### Escanear Historial
```bash
git secrets --scan-history
```

### Listar Patrones Configurados
```bash
git secrets --list
```

### Agregar Nuevo Patrón
```bash
git secrets --add 'patron-regex'
```

### Agregar Patrón Permitido (Whitelist)
```bash
git secrets --add --allowed 'patron-permitido'
```

---

## 📋 Archivos Siempre Ignorados

Estos archivos están en `.gitignore` y NUNCA se subirán:

- `.env` - Variables de entorno locales
- `.env.local` - Variables locales
- `.env.production` - Variables de producción
- `*.key` - Archivos de llaves
- `*.pem` - Certificados
- `secrets/` - Directorio de secretos

---

## 🚨 Si Detecta un Secreto

### El commit será BLOQUEADO con un mensaje como:

```
test.txt:1:OPENROUTER_API_KEY=sk-or-v1-abc123...

[ERROR] Matched one or more prohibited patterns

Possible mitigations:
- Mark false positives as allowed using: git config --add secrets.allowed ...
- List your configured patterns: git secrets --list
- List your configured allowed patterns: git secrets --list --allowed
```

### Qué Hacer:

1. **NO forzar el commit** con `--no-verify`
2. **Remover el secreto** del archivo
3. **Usar variables de entorno** en su lugar
4. **Verificar** que el secreto no esté en el historial

---

## 🔄 Configuración Global (Opcional)

Para aplicar git-secrets a TODOS tus repositorios:

```bash
# Instalar globalmente
git secrets --install ~/.git-templates/git-secrets
git config --global init.templateDir ~/.git-templates/git-secrets

# Registrar patrones globales
git secrets --register-aws --global
git secrets --add --global 'sk-or-v1-[a-zA-Z0-9]{64}'
```

---

## 📊 Estado de Seguridad

| Protección | Estado |
|------------|--------|
| **git-secrets** | ✅ Instalado |
| **Pre-commit Hook** | ✅ Activo |
| **Patrones OpenRouter** | ✅ Configurado |
| **Patrones AWS** | ✅ Configurado |
| **Patrones GitHub** | ✅ Configurado |
| **Patrones Genéricos** | ✅ Configurado |

---

## 🎯 Mejores Prácticas

1. ✅ **Nunca** hardcodear API keys en el código
2. ✅ **Siempre** usar variables de entorno
3. ✅ **Verificar** `.gitignore` antes de commits
4. ✅ **Escanear** el repositorio regularmente
5. ✅ **Revocar** inmediatamente si se expone una key
6. ✅ **Rotar** API keys periódicamente

---

## 📞 En Caso de Exposición

1. **Revocar** la API key inmediatamente
2. **Generar** nueva API key
3. **Actualizar** en Vercel/servicios
4. **Escanear** historial de git
5. **Limpiar** historial si es necesario (git filter-branch)

---

## ✅ Verificación

Para verificar que todo funciona:

```bash
# 1. Escanear repo actual
git secrets --scan

# 2. Probar con un secreto falso
echo "test_key=sk-or-v1-test" > test.txt
git add test.txt
git commit -m "test"
# Debería FALLAR ✅

# 3. Limpiar
rm test.txt
git reset HEAD test.txt
```

---

**Tu repositorio está ahora protegido contra exposición de secretos** 🛡️

**Última Actualización**: 14 de Octubre, 2025  
**Versión**: 1.0 (Git Guardian Active)
